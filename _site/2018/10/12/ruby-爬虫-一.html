<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/yqwoe.github.io/theme/img/favicon.ico" >
    <title>
        
            ruby 爬虫 一 &middot; Yq Woe
        
    </title>

    <script src="/yqwoe.github.io/theme/js/jquery-3.2.1.min.js"></script>
    <script src="/yqwoe.github.io/theme/js/popper.min.js"></script>
    <script src="/yqwoe.github.io/theme/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/yqwoe.github.io/theme/css/bootstrap.css">
    <link rel="stylesheet" href="/yqwoe.github.io/theme/css/site.css">
    <link rel="stylesheet" href="/yqwoe.github.io/theme/css/syntax.css">
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ruby 爬虫 一 | Yq Woe</title>
<meta name="generator" content="Jekyll v3.8.2" />
<meta property="og:title" content="ruby 爬虫 一" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="​ 拖延了半个多月，把之前写的东西整理一下发现，好多内容都在脑子里，没有形成转化后的内容，所以，吃过晚饭就决定写完在睡觉。 Time.now.to_s =&gt; &quot;2018-10-30 20:29:36 +0800&quot;" />
<meta property="og:description" content="​ 拖延了半个多月，把之前写的东西整理一下发现，好多内容都在脑子里，没有形成转化后的内容，所以，吃过晚饭就决定写完在睡觉。 Time.now.to_s =&gt; &quot;2018-10-30 20:29:36 +0800&quot;" />
<link rel="canonical" href="http://localhost:4000/yqwoe.github.io/2018/10/12/ruby-%E7%88%AC%E8%99%AB-%E4%B8%80.html" />
<meta property="og:url" content="http://localhost:4000/yqwoe.github.io/2018/10/12/ruby-%E7%88%AC%E8%99%AB-%E4%B8%80.html" />
<meta property="og:site_name" content="Yq Woe" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-12T00:00:00+08:00" />
<script type="application/ld+json">
{"datePublished":"2018-10-12T00:00:00+08:00","url":"http://localhost:4000/yqwoe.github.io/2018/10/12/ruby-%E7%88%AC%E8%99%AB-%E4%B8%80.html","dateModified":"2018-10-12T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/yqwoe.github.io/2018/10/12/ruby-%E7%88%AC%E8%99%AB-%E4%B8%80.html"},"description":"​ 拖延了半个多月，把之前写的东西整理一下发现，好多内容都在脑子里，没有形成转化后的内容，所以，吃过晚饭就决定写完在睡觉。 Time.now.to_s =&gt; &quot;2018-10-30 20:29:36 +0800&quot;","@type":"BlogPosting","headline":"ruby 爬虫 一","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<style>
    table{
    /* border-left:1px solid #000000;border-top:1px solid #000000; */
    /* width: 100%; */
    /* word-wrap:break-word; word-break:break-all; */
    border: 1px solid #dee2e6;
    width: 100%;
    max-width: 100%;
    margin-bottom: 15px;
    background-color: transparent;
    border-collapse: collapse;
    display: table;
    border-spacing: 2px;
    text-align:center;
  }
  table thead tbody{
  display: table-row-group;
    vertical-align: middle;
    border-color: inherit;
  }
  table tbody tr:nth-of-type(odd) {
    background-color: rgba(0,0,0,0.05);
}
</style>

<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top justify-content-between">
    <a class="navbar-brand font-weight-bold" href="/yqwoe.github.io/index.html">Yq Woe</a>
    <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarContent" >
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a href="http://localhost:4000/feed.xml" class="nav-link">RSS订阅</a>
                    </li>
        
            <li class="nav-item">
                <a href='/yqwoe.github.io/index.html'
                   class="nav-link">
                    主页
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/yqwoe.github.io/about.html'
                   class="nav-link">
                    关于
                </a>
            </li>
        
            <li class="nav-item">
                <a href='/yqwoe.github.io/list/posts.html'
                   class="nav-link">
                    文章
                </a>
            </li>
        
        </ul>
    </div>
</nav>








<div class="container site-container" id="top">
    <div class="row">
        <div class="d-none d-lg-block col-lg-4 col-xl-4 side">
            








    <div class="sticky-top space-before">
    <div class="card bg-light mb-3">
        <div class="card-body">
            <div class="card-title">
                <h5>2018年10月12日</h5>
            </div>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/yqwoe.github.io/list/posts.html#ruby"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        ruby
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#爬虫"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        爬虫
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#python"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        python
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#java"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        java
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#kimurai"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        kimurai
                    </a>
                
            </div>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/yqwoe.github.io/list/posts.html"> 回到文章 </a>
            </div>
        </div>
    </div>
</div>






        </div>
        <div class="col-md-12 col-lg-8 col-xl-8 pb-4 content">
            <link rel="stylesheet" href="/yqwoe.github.io/static/css/gitment.css">
<script src="/yqwoe.github.io/static/js/gitment.js"></script>
<h1 class="border border-top-0 border-right-0 border-left-0 mb-3 pb-2">ruby 爬虫 一</h1>

<div class="d-md-block d-lg-none">
    <div class="sticky-top space-before">
    <div class="card bg-light mb-3">
        <div class="card-body">
            <div class="card-title">
                <h5>2018年10月12日</h5>
            </div>
            <div class="d-flex flex-wrap align-items-center">
                <span class="icon grey mr-2 mb-2">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Price_tag" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<g>
	<path d="M19.388,0.405c-0.111-0.314-0.454-0.48-0.769-0.371c-0.315,0.109-0.481,0.455-0.372,0.77
		c0.929,2.67-0.915,4.664-2.321,5.732l-0.568-0.814c-0.191-0.273-0.618-0.5-0.95-0.504L11.22,5.232
		c-0.332-0.006-0.825,0.146-1.097,0.338l-9.394,6.587c-0.455,0.32-0.565,0.947-0.247,1.404l4.269,6.108
		c0.32,0.455,0.831,0.4,1.287,0.082l9.394-6.588c0.27-0.191,0.582-0.603,0.692-0.918l0.998-3.145
		c0.11-0.314,0.043-0.793-0.148-1.066l-0.346-0.496C18.516,6.091,20.476,3.534,19.388,0.405z M15.017,9.763
		c-0.727,0.51-1.731,0.332-2.24-0.396c-0.511-0.73-0.333-1.734,0.395-2.246C13.75,6.716,14.5,6.745,15.04,7.138
		c-0.272,0.164-0.459,0.26-0.494,0.275c-0.301,0.143-0.43,0.504-0.288,0.805c0.104,0.219,0.321,0.348,0.547,0.348
		c0.086,0,0.174-0.02,0.257-0.059c0.194-0.092,0.402-0.201,0.619-0.33C15.778,8.771,15.542,9.394,15.017,9.763z"/>
</g>
</svg>

                </span>
                
                    <a href="/yqwoe.github.io/list/posts.html#ruby"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        ruby
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#爬虫"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        爬虫
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#python"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        python
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#java"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        java
                    </a>
                
                    <a href="/yqwoe.github.io/list/posts.html#kimurai"
                       class="bg-white border rounded p-1 mr-2 mb-2 d-inline-block">
                        kimurai
                    </a>
                
            </div>
            <div class="d-flex align-items-center mt-2">
                <span class="icon grey mr-1">
                    <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 18.1.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->

<svg version="1.1" id="Arrow_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
<path d="M2.5,10L9,3.5V7h8v6H9v3.5L2.5,10z"/>
</svg>

                </span>
                <a href="/yqwoe.github.io/list/posts.html"> 回到文章 </a>
            </div>
        </div>
    </div>
</div>

</div>

<p>​	拖延了半个多月，把之前写的东西整理一下发现，好多内容都在脑子里，没有形成转化后的内容，所以，吃过晚饭就决定写完在睡觉。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">=&gt;</span> <span class="s2">"2018-10-30 20:29:36 +0800"</span>
</code></pre></div></div>

<!--more-->

<p>​	印象中，大多数人做爬虫第一个想到的肯定是python，”python解决方案多，代码简洁，容易上手…“,blah..blah</p>

<p>​	事实上我也写python，但是强制缩进这点让我很伤脑筋，没用ruby之前，我觉得python可能是我做java以来最优雅的语言。直到我用ruby。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
	<span class="nb">puts</span> <span class="s2">"I Love Ruby!!"</span>
<span class="k">end</span>
<span class="o">=&gt;</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
<span class="s2">"I Love Ruby!!"</span>
</code></pre></div></div>

<p>​	废话不多说。</p>

<p>​	为什么选择用ruby，而不用python呢？</p>

<p>​	不为别的，就是顺手而已。</p>

<h1 id="kimurai">kimurai</h1>

<blockquote>
  <p>Kimurai 是一个用Ruby 实现的现代网络爬虫框架，和 <strong>Headless Chromium</strong> / <strong>Firefox</strong> 、<strong>PhantomJS</strong> 一样开箱即用，并且能够模拟<strong>“用户”</strong>访问抓取javascript交互的网站。</p>

  <p>Kimurai基于 <strong><a href="https://github.com/teamcapybara/capybara">Capybara</a></strong> 和 <strong><a href="https://github.com/sparklemotion/nokogiri">Nokogir</a></strong> gems，所以你不必学习新的东西。</p>
</blockquote>

<h2 id="实操">实操</h2>

<h4 id="1安装">1.安装</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem <span class="nb">install </span>kimurai 
</code></pre></div></div>

<p>使用<a href="http://npm.taobao.org/mirrors/chromedriver/">chromiumdriver</a> 或<a href="https://github.com/ariya/phantomjs">phantomJS</a>需另外安装。</p>

<h4 id="2创建项目demo">2.创建项目demo</h4>

<p>kimurai提供了像rails new project这样的命令式创建项目。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kimurai generate project demo
</code></pre></div></div>

<p>等待命令执行完成会生成如下结构</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|demo
	|config  #用于存放全局配置
		|application.rb #全局配置
		|automaiton.yml #用于配置浏览器和部署
		|schedule.rb #支持定时任务
	|db #数据库文件？
	|helpers #辅助方法
	|lib #插件
	|log #日志
	|pipelines 
	|spiders #爬虫存放目录
	|tmp #缓存文件

</code></pre></div></div>

<h4 id="3创建spider">3.创建spider</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kimurai</span> <span class="n">generate</span> <span class="n">spider</span> <span class="n">test_spider</span>

<span class="c1">#demo/spiders/test_spider.rb</span>
<span class="k">class</span> <span class="nc">TestSpider</span> <span class="o">&lt;</span> <span class="no">ApplicationSpider</span>
  <span class="vi">@name</span> <span class="o">=</span> <span class="s2">"test_spider"</span>
  <span class="vi">@start_urls</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="vi">@config</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">url</span><span class="p">:,</span> <span class="ss">data: </span><span class="p">{})</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<h4 id="4修改spider">4.修改spider</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TestSpider</span> <span class="o">&lt;</span> <span class="no">ApplicationSpider</span>
  <span class="vi">@name</span> <span class="o">=</span> <span class="s2">"test_spider"</span>
  <span class="vi">@start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://baike.pcbaby.com.cn"</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">url</span><span class="p">:,</span> <span class="ss">data: </span><span class="p">{})</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">items</span><span class="p">[</span><span class="ss">:links</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//div[@class='baike-th main']"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
      <span class="n">logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">row</span><span class="p">.</span><span class="nf">to_s</span>
      <span class="n">items</span><span class="p">[</span><span class="ss">:links</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
          <span class="ss">title: </span><span class="n">row</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s2">"/a"</span><span class="p">).</span><span class="nf">text</span><span class="p">.</span><span class="nf">squish</span><span class="p">,</span>
          <span class="ss">url: </span><span class="s2">"https:</span><span class="si">#{</span><span class="n">row</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s2">"/a"</span><span class="p">).</span><span class="nf">first</span><span class="p">[</span><span class="s2">"href"</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
      <span class="p">}</span>
    <span class="k">end</span>

    <span class="n">save_to</span> <span class="s2">"results.json"</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="ss">format: :pretty_json</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h5 id="resultsjson">results.json</h5>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"备孕百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/yunqian.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"孕期百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/yunqi.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"分娩百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/fenmian.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"月子百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/yuezi.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"新生儿百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/xinshenger.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0-1岁百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/yinger.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1-3岁百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/youer.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3-6岁百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/xuelingqian.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"用品百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/yongpin.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"美食百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/meishi.html"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"生活百科"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://baike.pcbaby.com.cn/shenghuo.html"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"position"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h4 id="5application_spiderrb">5.application_spider.rb</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ApplicationSpider is a default base spider class. You can set here</span>
<span class="c1"># default settings for all spiders inherited from ApplicationSpider.</span>
<span class="c1"># To generate a new spider, run: `$ kimurai generate spider spider_name`</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'kimurai'</span>
<span class="k">class</span> <span class="nc">ApplicationSpider</span> <span class="o">&lt;</span> <span class="no">Kimurai</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">ApplicationHelper</span>
    
  <span class="vi">@engine</span> <span class="o">=</span> <span class="ss">:selenium_chrome</span>
  <span class="no">USER_AGENTS</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1"># PROXIES = ["127.0.0.1:1086:socks5"]</span>

  <span class="vi">@config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">user_agent: </span><span class="s2">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"</span><span class="p">,</span>
    <span class="ss">skip_request_errors: </span><span class="p">[{</span> <span class="ss">error: </span><span class="no">RuntimeError</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"404 =&gt; Net::HTTPNotFound"</span> <span class="p">}],</span>
	<span class="ss">retry_request_errors: </span><span class="p">[</span><span class="no">Net</span><span class="o">::</span><span class="no">ReadTimeout</span><span class="p">],</span>
    <span class="ss">restart_if: </span><span class="p">{</span>
    <span class="p">},</span>
    <span class="ss">before_request: </span><span class="p">{</span>
        <span class="ss">delay: </span><span class="mi">4</span><span class="o">..</span><span class="mi">7</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="k">end</span>

</code></pre></div></div>

<h4 id="6运行">6.运行</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">kimurai</span> <span class="n">runner</span> <span class="o">-</span><span class="n">j</span> <span class="mi">3</span> 
</code></pre></div></div>

<p>可以依次运行多个爬虫。</p>

<p>按照以上步骤可以运行示例中的代码。</p>

<p>更多细节配置可以查看 <a href="https://github.com/vifreefly/kimuraframework#installation">kimurai</a></p>



<div id="container"></div>
<script>
var myTheme = {
  render(state, instance) {
    const container = document.createElement('div')
    container.lang = "zh-CN"
    container.className = 'gitment-container gitment-root-container'
    container.appendChild(instance.renderHeader(state, instance))
    container.appendChild(instance.renderEditor(state, instance))
    container.appendChild(instance.renderComments(state, instance))
    container.appendChild(instance.renderFooter(state, instance))
    return container
  },
}
console.log(location)

var paths = location.pathname.split('/')
console.log(paths)
console.log(decodeURI(paths[paths.length - 1 ]))
var gitment = new Gitment({
    id: decodeURI(paths[paths.length - 1 ]),
  owner: 'yqwoe',
  repo: 'yqwoe.github.io',
  oauth: {
    client_id: '38908a117aeb2426fddb',
    client_secret: 'fab30686c5598f5ba19e726492b27e33e40eceda',
  },
  theme: myTheme
})
gitment.render('container')
</script>
<style>
blockquote{
          font: 14px/22px normal helvetica, sans-serif;
          margin-top: 10px;
          margin-bottom: 10px;
          margin-left: 50px;
          padding-left: 15px;
          padding-top: 10px;
          padding-right: 10px;
          padding-bottom: 10px;
          border-left: 3px solid #ccc;
          background-color:none;
     }
</style>





        </div>
        <div class="col-md-12 d-lg-none bottom">
            

        </div>
    </div>
</div>

<script type="text/javascript">
/*!
 * IE10 viewport hack for Surface/desktop Windows 8 bug
 * Copyright 2014-2017 The Bootstrap Authors
 * Copyright 2014-2017 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

// See the Getting Started docs for more information:
// https://getbootstrap.com/getting-started/#support-ie10-width

(function () {
    'use strict'

    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
        var msViewportStyle = document.createElement('style')
        msViewportStyle.appendChild(
            document.createTextNode(
                '@-ms-viewport{width:auto!important}'
            )
        )
        document.head.appendChild(msViewportStyle)
    }
}())
</script>

</body>
<style>
    blockquote{
        display:block;
        background: #fff;
        padding: 15px 20px 15px 45px;
        margin: 0 0 20px;
        position: relative;

        /*字体*/
        font-family: Georgia, serif;
        font-size: 16px;
        line-height: 1.2;
        color: #666;
        text-align: justify;

        /*边框 - (选项)*/
        /*border-left: 15px solid #c76c0c;*/
        /*border-right: 2px solid #c76c0c;*/

        /*盒子阴影 - (选项)*/
        -moz-box-shadow: 2px 2px 15px #ccc;
        -webkit-box-shadow: 2px 2px 15px #ccc;
        box-shadow: 2px 2px 15px #ccc;
    }
    blockquote::before{
        content: "\201C"; /*左双引号的Unicode编码*/

        /*字体*/
        font-family: Georgia, serif;
        font-size: 40px;
        font-weight: bold;
        color: #999;

        /*位置*/
        position: absolute;
        left: 10px;
        top:5px;
    }
    blockquote::after{
        content: ""; /*如果要显示右双引号，则写 content: "\201D"; */
    }


</style>

</html>
