<!DOCTYPE html><html><head><meta charset="utf-8"><title>前端定时器 | rm -rf /*</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="{{ url_for(theme.favicon.safari_pinned_tab) }}" color="{{ theme.android_chrome_color }}"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/katex.min.css"><link rel="stylesheet" href="/css/googleapis.css"><link rel="stylesheet" href="/css/highlight.css"><meta name="description" content="前端开发中，会经常接到定时器的需求，倒计时、计时器、动画效果。"><meta property="og:type" content="article"><meta property="og:title" content="前端定时器"><meta property="og:url" content="https://rm-rf.ink/*/3423146f.html"><meta property="og:site_name" content="rm -rf &#x2F;*"><meta property="og:description" content="前端开发中，会经常接到定时器的需求，倒计时、计时器、动画效果。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-01-11T07:09:31.000Z"><meta property="article:modified_time" content="2024-01-15T03:34:01.469Z"><meta property="article:author" content="Yq Woe"><meta property="article:tag" content="vue"><meta property="article:tag" content="react"><meta property="article:tag" content="javascript"><meta property="article:tag" content="typescript"><meta property="article:tag" content="setTimeout"><meta property="article:tag" content="setInterval"><meta property="article:tag" content="requestAnimationFrame"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/reveal.css"><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="rm -rf /*" type="application/atom+xml">
</head><body><div id="wrapper"><header id="header"><div class="poem-wrap"><div class="poem-border poem-left"></div><div class="poem-border poem-right"></div><h1><a href="/">rm -rf /*</a></h1><p id="poem">加载中...</p><p id="info"></div><nav><a class="nav-link" href="/">首页</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/categories">分类</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/tags">标签</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/about">关于</a></nav></header><div id="content"><article id="post-前端定时器" class="article article-type-post" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h2 class="article-title" itemprop="headline name">前端定时器</h2><div class="article-meta"><time class="article-date" datetime="2024-01-11T07:09:31.000Z" itemprop="datePublished">2024.01.11 15:09 下午</time></div></header><div class="article-entry" itemprop="articleBody"><div id="toc" class="toc-article"><div class="toc-title">目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-text">1.定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-settimeout"><span class="toc-text">1.1. setTimeout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-setinterval"><span class="toc-text">1.2. setInterval</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-requestanimationframe"><span class="toc-text">1.3. requestAnimationFrame</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%A0%87%E7%AD%BE%E5%8A%A8%E7%94%BB"><span class="toc-text">2. 标签动画</span></a></li></ol></div><p>  前端开发中，会经常接到<code>定时器</code>的需求，<code>倒计时</code>、<code>计时器</code>、<code>动画效果</code>。</p><span id="more"></span><p>  在<code>博客</code>- <a href="/tags">标签</a>页面中使用到了<code>定时器</code>来做<code>::hover</code>动画效果。接下来我会对比一下<code>setTimeout</code>、<code>setInterval</code>、<code>requestAnimationFrame</code>来实现定时器。</p><div style="display:flex;justify-content:center"><div><video width="100%" height="auto" src="/images/video/tags-view.mp4" autoplay muted loop></video><div style="text-align:center;user-select:none">视频： 博客-标签</div></div></div><h1 id="1定时器"><a class="markdownIt-Anchor" href="#1定时器"></a> 1.定时器</h1><h2 id="11-settimeout"><a class="markdownIt-Anchor" href="#11-settimeout"></a> 1.1. setTimeout</h2><p>  <strong>setTimeout是JavaScript中的一个函数，用于在指定的延迟时间后执行一段代码或函数。它的工作原理是在指定的延迟时间后，将代码或函数放入JavaScript的事件队列中，等待当前代码执行完毕后再执行。</strong></p><p><strong>setTimeout的语法如下：</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>||<span class="string">&#x27;func()&#x27;</span>,delay,[args...])</span><br></pre></td></tr></table></figure><p><strong>参数说明：</strong></p><ul class="lvl-0"><li class="lvl-2"><p><code>func|code</code>：要执行的函数或代码。</p></li><li class="lvl-2"><p><code>delay</code>：延迟时间，以毫秒为单位。</p></li><li class="lvl-2"><p><code>arg1, arg2, ...</code>：可选参数，表示传递给函数的参数。</p></li></ul><p>  当使用setTimeout时，它将在指定的延迟时间后执行一次函数或代码，然后返回一个定时器ID，可以使用<code>clearTimeout()</code>方法来取消定时器的执行。</p><p>  需要注意的是，setTimeout并不会立即执行函数或代码，而是在指定的延迟时间后放入事件队列中等待执行。如果当前的代码执行时间较长，或者存在其他的延迟操作，那么setTimeout中的函数或代码可能会在预期的时间之后才被执行。</p><p><strong>示例:</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">args</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setTimeout</span>(test,<span class="number">1000</span>,[<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>]);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="string">&#x27;test()&#x27;</span>,<span class="number">1000</span>,[<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>]);</span><br><span class="line"><span class="title function_">cleatTimeout</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="12-setinterval"><a class="markdownIt-Anchor" href="#12-setinterval"></a> 1.2. setInterval</h2><p>  <strong>setInterval是JavaScript中的一个函数，用于在指定的时间间隔后重复执行一段代码或函数。它的工作原理是在指定的时间间隔后，将代码或函数放入JavaScript的事件队列中，等待当前代码执行完毕后再执行。</strong></p><p><strong>setInterval的语法如下：</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>||<span class="string">&#x27;func()&#x27;</span>,delay,[args...])</span><br></pre></td></tr></table></figure><p><strong>参数说明：</strong></p><ul class="lvl-0"><li class="lvl-2"><p><code>func|code</code>：要执行的函数或代码。</p></li><li class="lvl-2"><p><code>delay</code>：时间间隔，以毫秒为单位。</p></li><li class="lvl-2"><p><code>arg1, arg2, ...</code>：可选参数，表示传递给函数的参数。</p></li></ul><p>  当使用setInterval时，它将在指定的时间间隔后重复执行函数或代码，直到调用<code>clearInterval()</code>方法来停止执行。与setTimeout不同的是，setInterval会持续不断地重复执行函数或代码，直到被明确停止。</p><p>  需要注意的是，setInterval并不会立即执行函数或代码，而是在指定的时间间隔后放入事件队列中等待执行。如果当前的代码执行时间较长，或者存在其他的延迟操作，那么setInterval中的函数或代码可能会在预期的时间之后才被执行。</p><p><strong>示例:</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">args</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(test,<span class="number">1000</span>,[<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>]);</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="string">&#x27;test()&#x27;</span>,<span class="number">1000</span>,[<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;test1&#x27;</span>]);</span><br><span class="line"><span class="built_in">clearInterval</span>();</span><br></pre></td></tr></table></figure><h2 id="13-requestanimationframe"><a class="markdownIt-Anchor" href="#13-requestanimationframe"></a> 1.3. requestAnimationFrame</h2><p>  <strong>requestAnimationFrame是Web动画API的一部分，用于在浏览器下一次重绘之前调用指定的回调函数，从而实现平滑的动画效果。与setTimeout和setInterval相比，requestAnimationFrame具有更高的性能和更好的用户体验。</strong></p><p><strong>requestAnimationFrame的语法如下：</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">requestAnimationFrame</span>(callback);</span><br></pre></td></tr></table></figure><p><strong>参数说明：</strong></p><ul class="lvl-0"><li class="lvl-2"><p><code>callback</code>：要执行的回调函数。</p></li></ul><p>  当使用requestAnimationFrame时，它会返回一个唯一的ID，可以使用这个ID来取消动画帧的调用。与setTimeout和setInterval不同的是，requestAnimationFrame的回调函数将在浏览器下一次重绘之前执行，而不是简单地等待指定的时间后执行。这样可以充分利用浏览器的重绘机制，实现更平滑的动画效果。</p><p>  requestAnimationFrame的优势在于它能够根据浏览器的刷新率来同步动画，避免了由于不同的屏幕刷新率和硬件配置导致的动画卡顿和闪烁。同时，它也避免了在动画过程中不必要的重绘和计算，提高了动画的性能和响应性。</p><p>  使用requestAnimationFrame时需要注意，它只会在浏览器处于激活状态时执行回调函数。如果浏览器处于最小化或隐藏状态，那么回调函数将不会被执行。因此，在使用requestAnimationFrame时，需要确保浏览器处于激活状态，或者在回调函数中添加适当的逻辑来处理浏览器不处于激活状态的情况。</p><p><strong>示例:</strong></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">frame</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;frame&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(frame);</span><br></pre></td></tr></table></figure><h1 id="2-标签动画"><a class="markdownIt-Anchor" href="#2-标签动画"></a> 2. 标签动画</h1><p>  使用 <code>requestAnimationFrame</code> 可以替代 <code>setInterval</code> 来实现定时任务，因为 <code>requestAnimationFrame</code> 更加高效，能够根据屏幕刷新率来同步动画，避免了不必要的重绘和计算。</p><p>下面是使用 <code>requestAnimationFrame</code> 实现 <code>setInterval</code> 更新<code>博客</code>- <a href="/tags">标签</a>的示例代码：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 兼容不支持requestAnimationFrame的浏览器</span></span><br><span class="line"><span class="comment"> ***/</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">requestAnimationFrame</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">requestAnimationFrame</span> ||</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">webkitRequestAnimationFrame</span> ||<span class="comment">/* Safari 和 Chrome */</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">mozRequestAnimationFrame</span> ||<span class="comment">/* Firefox */</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">oRequestAnimationFrame</span>      ||<span class="comment">/* Opera */</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">msRequestAnimationFrame</span>     ||<span class="comment">/* IE 9 */</span></span><br><span class="line">    <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(callback, <span class="number">6000</span> / <span class="number">60</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">cancelAnimationFrame</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">cancelAnimationFrame</span> ||</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">webkitCancelAnimationFrame</span> ||</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">mozCancelAnimationFrame</span> ||</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">oCancelAnimationFrame</span> ||</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">msCancelAnimationFrame</span> || <span class="built_in">clearTimeout</span></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置精度定时器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; 回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125;   延迟时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;  定时器ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">setIntervalPrecision</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">  <span class="comment">// 生成并记录定时器ID</span></span><br><span class="line">  <span class="keyword">let</span> obj = <span class="variable language_">window</span>.<span class="property">interValPrecisionObj</span> || (<span class="variable language_">window</span>.<span class="property">interValPrecisionObj</span> = &#123; <span class="attr">num</span>: <span class="number">0</span> &#125;)</span><br><span class="line">  obj.<span class="property">num</span>++</span><br><span class="line">  obj[<span class="string">&#x27;n&#x27;</span> + obj.<span class="property">num</span>] = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">var</span> intervalId = obj.<span class="property">num</span></span><br><span class="line">  <span class="comment">// 开始时间</span></span><br><span class="line">  <span class="keyword">var</span> startTime = +<span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  <span class="comment">// 已执行次数</span></span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">  <span class="comment">// 延迟时间</span></span><br><span class="line">  delay = delay || <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ;(<span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 定时器被清除，则终止</span></span><br><span class="line">    <span class="keyword">if</span> (!obj[<span class="string">&#x27;n&#x27;</span> + intervalId]) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 满足条件执行回调</span></span><br><span class="line">    <span class="keyword">if</span> (+<span class="keyword">new</span> <span class="title class_">Date</span>() &gt; startTime + delay * (count + <span class="number">1</span>)) &#123;</span><br><span class="line">      count++</span><br><span class="line">      <span class="title function_">callback</span>(count)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(loop)</span><br><span class="line">  &#125;)()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> intervalId</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清除精度定时器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; 定时器ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearIntervalPrecision</span>(<span class="params">intervalId</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">interValPrecisionObj</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">cancelAnimationFrame</span>(<span class="string">&#x27;n&#x27;</span> + intervalId)</span><br><span class="line">    <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">interValPrecisionObj</span>[<span class="string">&#x27;n&#x27;</span> + intervalId]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//loopHover 自己的业务实现</span></span><br><span class="line">setIntervalPrecision(loopHover, <span class="number">100</span>)</span><br></pre></td></tr></table></figure></div><div class="article-category"><a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a> <b>&nbsp;:分类</b><br><a class="article-tag-none-link" href="/tags/javascript/" rel="tag">javascript</a>, <a class="article-tag-none-link" href="/tags/react/" rel="tag">react</a>, <a class="article-tag-none-link" href="/tags/requestAnimationFrame/" rel="tag">requestAnimationFrame</a>, <a class="article-tag-none-link" href="/tags/setInterval/" rel="tag">setInterval</a>, <a class="article-tag-none-link" href="/tags/setTimeout/" rel="tag">setTimeout</a>, <a class="article-tag-none-link" href="/tags/typescript/" rel="tag">typescript</a>, <a class="article-tag-none-link" href="/tags/vue/" rel="tag">vue</a> <b>&nbsp;:标签</b></div></div></article><nav id="article-nav" class="article-nav"><a href="/*/9ddcf808.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title">麻辣炒虾尾 🦞</div></a><a href="/*/b2113df8.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title">炝锅面</div></a></nav><div id="gitalk-container" style="padding:0 30px 0 30px"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"d99a4bdc344cff33585d",clientSecret:"4819ca8aa103e688f259b5ed6b3cd3fffdf0f96e",repo:"yqwoe.github.io",owner:"yqwoe",admin:["yqwoe"],id:"3423146f",distractionFreeMode:"true",title:"前端定时器",body:"🚀"+location.href+"\n\n欢迎通过 issues 留言 ，相互交流学习"});gitalk.render("gitalk-container")</script></div></div><div id="settings-container"><div id="dark-mode"></div><div id="sans-font"></div></div><span class="post-count">23.2k</span><script type="text/javascript">let d=document,r=d.documentElement.style,f=r.setProperty.bind(r),l=localStorage,s=l.getItem("s")||window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,n=l.getItem("n"),m=d.getElementById("dark-mode"),b=()=>{f("--bg-color","#fafafa"),f("--code-bg-color","#f4f4f4"),f("--text-color","#212121"),f("--secondary-color","#808080"),f("--tertiary-color","#b0b0b0"),f("--link-color","#b5c8cf"),f("--link-hover-color","#618794"),f("--link-bg-color","#dae4e7"),f("--selection-color","#dae4e7")},c=()=>{f("--bg-color","#212121"),f("--code-bg-color","#292929"),f("--text-color","#fff"),f("--secondary-color","#c0c0c0"),f("--tertiary-color","#6e6e6e"),f("--link-color","#4d6b75"),f("--link-hover-color","#96b1bb"),f("--link-bg-color","#5d828e"),f("--selection-color","#acc1c9")},o=d.getElementById("sans-font"),e=()=>{f("--body-stack",'"Lora", "Georgia", "Times New Roman", serif')},g=()=>{f("--body-stack",'"Lato", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "Verdana", sans-serif')};m.onclick=function(){2==s?(s=1,l.setItem("s",s),c()):(s=2,l.setItem("s",s),b())},o.onclick=function(){2==n?(n=1,l.setItem("n",n),g()):(n=2,l.setItem("n",n),e())},(s||"1"==s)&&(s=1,l.setItem("s",s),c()),s&&"2"!=s||(s=2,l.setItem("s",s),b()),n||(n=2,l.setItem("n",2)),"1"==n&&g(),"2"==n&&e()</script><script type="module">import mermaid from"https://cdn.jsdelivr.net/npm/mermaid@9.4.3/+esm";let theme=localStorage.getItem("s");mermaid.initialize({startOnLoad:!0,logLevel:"debug",theme:"2"===theme?"forest":"dark"});let mode=document.getElementById("dark-mode"),arrayGraphs=[],nodes=document.getElementsByClassName("mermaid");for(let e of nodes)console.log(e.innerHTML),arrayGraphs.push(e.innerHTML);mode.addEventListener("click",async()=>{theme=localStorage.getItem("s"),mermaid.initialize({startOnLoad:!0,logLevel:"debug",theme:"2"===theme?"forest":"dark"});for(let e=0;e<nodes.length;e++){let t=nodes[e];t.removeAttribute("data-processed"),t.setAttribute("id","mermaid-"+e),t.replaceChildren(),t.innerHTML=arrayGraphs[e],mermaid.init(void 0,t)}},!1)</script><script src="/js/jquery.min.js" defer></script><script src="/js/jquery.qrcode.min.js" defer></script><script type="module">import qrcodeInit from"/js/qrcode.js";qrcodeInit()</script><script type="module">window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,100)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout</script><script type="module">function get_poem(e,n){var t=document.querySelector(e),o=document.querySelector(n),i=new XMLHttpRequest;i.open("get","https://v2.jinrishici.com/one.json?client=browser-sdk/1.2"),i.withCredentials=!0,i.onreadystatechange=function(){if(4===i.readyState){var e=JSON.parse(i.responseText);t.innerHTML=e.data.content,o.innerHTML="["+e.data.origin.dynasty+"] "+e.data.origin.author+"《"+e.data.origin.title+"》"}},i.send()}function modifySubmitBtn(){var e=$(".hbe-button"),n=$("#hbePass");e.length>0&&e.text("重新输入密码"),n.length>0&&n.attr("autocomplete","false")}function layoutTagCloud(){}function loopHover(){var e=$(".tagcloud a"),n=$('.tagcloud a[class="tag-hover"]'),t=Math.round(Math.random()*(e.length-1));if(t<0&&(t=0),t>e.length&&(t=e.length-1),e.length){if(n.length)for(let e=0;e<n.length;e++)n[e].classList="";e[t].classList="tag-hover"}}function setIntervalPrecision(e,n){let t=window.interValPrecisionObj||(window.interValPrecisionObj={num:0});t.num++,t["n"+t.num]=!0;var o=t.num,i=+new Date,a=0;return n=n||0,function r(){t["n"+o]&&(+new Date>i+n*(a+1)&&(a++,e(a)),window.requestAnimationFrame(r))}(),o}function clearIntervalPrecision(e){window.interValPrecisionObj&&(window.cancelAnimationFrame("n"+e),delete window.interValPrecisionObj["n"+e])}$("div").hasClass("poem-wrap")&&get_poem("#poem","#info"),modifySubmitBtn(),setIntervalPrecision(loopHover,100),window.revealLoading=revealLoading</script></body></html>